<div
  class="absolute h-full transition-transform transform -translate-x-full font-roboto <%= user.settings.theme === 'dark' ? 'bg-dark-background text-dark-text' : 'bg-primary text-background' %> backdrop-blur-lg bg-opacity-80 md:backdrop-blur-md md:bg-opacity-50 shadow-lg"
  id="sidebar"
>
  <aside class="sticky left-0 top-0 h-screen">
    <div class="p-4 md:p-8 flex flex-col justify-between h-full">
      <div class="profile-sidebar flex flex-col md:gap-4">
        <div
          class="profile-sidebar-header <%= user.settings.theme === 'dark' ? ' border-dark-tertiary' : ' border-tertiary' %> "
        >
          <div class="profile-sidebar-header-image mb-2 flex justify-center">
            <img
              src="<%= user.avatar ? user.avatar : '/images/defaultProfile.png' %>"
              draggable="false"
              alt="Profile Image"
              class="<%= user.avatar ? 'w-20 h-20 md:w-full md:h-auto' : 'w-40 h-40' %>   aspect-square rounded-md border <%= user.settings.theme === 'dark' ? 'border-dark-fourth' : 'border-gray-300' %>"
            />
          </div>
          <div class="profile-sidebar-header-content text-center">
            <p
              class="<%= user.settings.theme === 'dark' ? ' text-dark-tertiary' : ' text-fifth' %> text-left text-xs my-1 font-lora"
            >
              @<%= user.username %>
            </p>
            <div
              class="flex gap-2 items-center text-lg font-bold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-sixth' %> overflow-clip font-lora"
            >
              <h3><%= user.firstname %></h3>
              <h3><%= user.lastname %></h3>
              <% if (user.subscription === "pro") { %>
                <img src="images/icons/proIcon.svg" 
                draggable="false" alt="pro icon" class="h-6 w-6" />
                <% } else if (user.subscription === "elite") { %>
                <img src="images/icons/eliteIcon.svg"
                draggable="false" alt="elite icon" class="h-6 w-6" />
                <% } %>
            </div>
          </div>
        </div>
        <div
          class="grid grid-cols-3  border-y <%= user.settings.theme === 'dark' ? ' border-dark-tertiary' : ' border-tertiary' %> "
        >
          <a
            href="/followers/<%= user.slug %>"
            class="text-center cursor-pointer p-2 sm:p-1 md:p-2  <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md"
          >
            <h2
              class="text-xl font-semibold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background hover:text-fifth' %>"
                id="followerCount"
            >
              <%= user.followers.length %>
            </h2>
            <p
              class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-fifth' %> text-xs"
            >
              Followers
            </p>
          </a>

          <a
            href="/profile/<%= user.slug%>"
            class="text-center cursor-pointer p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md"
          >
            <h2
              class="text-xl font-semibold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background hover:text-fifth' %>"
            >
              <%= user.blogs.length %>
            </h2>
            <p
              class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-fifth' %> text-xs"
            >
              Blogs
            </p>
          </a>
          <a
            href="/following/<%= user.slug %>"
            class="text-center cursor-pointer p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md"
          >
            <h2
              class="text-xl font-semibold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background hover:text-fifth' %> "
              id="followingCount"
            >
              <%= user.following.length %>
            </h2>
            <p
              class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-fifth' %> text-xs"
            >
              Following
            </p>
          </a>
        </div>
        <div class="profile-sidebar-content">
          <ul class="text-base md:text-sm lg:text-base">
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a
                href="/profile/<%= user.slug%>"
                class="flex items-center gap-2"
              >
                <img
                  src="images/icons/profileIcon.svg"
                  alt="profile icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-4 h-4"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %>"
                >
                  Profile
                </p>
              </a>
            </li>
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/profile/edit" class="flex items-center gap-2">
                <img
                  src="images/icons/editProfileIcon.svg"
                  alt="edit profile icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-5 h-5"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %>"
                >
                  Edit Profile
                </p>
              </a>
            </li>
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/saveBlogs" class="flex items-center gap-2">
                <img
                  src="images/icons/savedBlogIcon.svg"
                  alt="draft icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-4 h-4"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %>"
                >
                  Saved Blogs
                </p>
              </a>
            </li>

            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/drafts" class="flex items-center gap-2">
                <img
                  src="images/icons/draftIcon.svg"
                  alt="draft icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-5 h-5"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
                >
                  Drafts
                </p>
              </a>
            </li>
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/archived" class="flex items-center gap-2">
                <img
                  src="images/icons/archiveIcon copy.svg"
                  alt="draft icon"
                  class="w-5 h-5 <%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
                >
                  Archived
                </p>
              </a>
            </li>
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/reports" class="flex items-center gap-2">
                <img
                  src="images/icons/reportIcon.svg"
                  alt="report icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-5 h-5"
                  draggable="false"
                />
                <p
                  href="/reports"
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %>"
                >
                  Reports
                </p></a
              >
            </li>
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/analytics" class="flex items-center gap-2">
                <img
                  src="images/icons/analyticIcon.svg"
                  alt="analytic icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-5 h-5"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %>"
                >
                  Analytics
                </p>
              </a>
            </li>
            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <a href="/notifications" class="flex items-center gap-2">
                <img
                  src="images/icons/notifyIcon.svg"
                  alt="notification icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-5 h-5"
                  draggable="false"
                />
                <p
                  class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %>"
                >
                  Notifications
                </p>
              </a>
            </li>

            <li
              class="p-2 sm:p-1 md:p-2 <%= user.settings.theme === 'dark' ? 'hover:bg-dark-fourth' : 'hover:bg-tertiary' %> rounded-md transition-colors duration-200"
            >
              <button
                onclick="openLogoutModal()"
                class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> flex items-center gap-2 w-full"
              >
                <img
                  src="images/icons/logoutIcon.svg"
                  alt="log out icon"
                  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %> w-5 h-5"
                  draggable="false"
                />

                Log Out
              </button>
            </li>
          </ul>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-2">
        <a
          href="/settings"
          class="<%= user.settings.theme === 'dark' ? 'bg-dark-fifth hover:bg-dark-background' : 'bg-tertiary hover:bg-fourth hover:invert-0' %> p-3 rounded-md flex justify-center items-center"
        >
          <img
            src="images/icons/settingIcon.svg"
            alt="Settings"
            draggable="false"
            class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert ' %> w-6 h-6"
          />
        </a>
        <a
          href="/contact"
          class="<%= user.settings.theme === 'dark' ? 'bg-dark-fifth hover:bg-dark-background' : 'bg-tertiary hover:bg-fourth' %> p-3 rounded-md flex justify-center items-center"
        >
          <img
            src="images/icons/supportIcon.svg"
            alt="Support"
            draggable="false"
            class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert ' %> w-7 h-7"
          />
        </a>
      </div>
    </div>
  </aside>
</div>

<div
  id="logoutModal"
  class="hidden fixed inset-0 z-10 flex items-center justify-center backdrop-blur-sm <%= user.settings.theme === 'dark' ? 'bg-dark-background text-dark-text' : ' text-text bg-primary' %> bg-opacity-50 p-5 md:p-0 z-50 font-lora"
>
  <div
    class="<%= user.settings.theme === 'dark' ? 'bg-dark-sixth text-dark-text' : 'bg-white text-gray-900' %> p-4 rounded-lg w-full sm:w-1/2 lg:w-1/3"
  >
     <!-- Header -->
     <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold font-sans">Confirm Logout</h2>
      <button
        onclick="closeLogoutModal()"
        class="text-gray-400 hover:text-red-500 transition duration-200 text-xl"
        aria-label="Close"
      >
        &times;
      </button>
    </div>
    <p class="text-sm mb-6 <%= user.settings.theme === 'dark' ? 'text-gray-400' : 'text-gray-600' %>">Are you sure you want to log out?</p>
    <div class="flex justify-end space-x-3">
      <button
        id="cancelLogoutButton"
        class="px-4 py-2 rounded-md border border-gray-300 text-sm font-medium <%= user.settings.theme === 'dark' ? 'text-gray-300 hover:bg-dark-primary' : 'text-gray-700 hover:bg-gray-100' %> transition duration-200"
        onclick="closeLogoutModal()"
      >
        Cancel
      </button>
      <button
        id="confirmLogoutButton"
        class="px-4 py-2 rounded-md bg-red-600 hover:bg-red-700 text-white text-sm font-medium shadow-md transition duration-200"
        onclick="logout()"
      >
        Log Out
      </button>
    </div>
  </div>
</div>

<script>
  const sidebar = document.getElementById("sidebar");
  const toggleButton = document.getElementById("sidebarToggle");
  const toggleButtonIcon = document.getElementById("sidebarToggleIcon");
  const logoutModal = document.getElementById("logoutModal");

  toggleButton.addEventListener("click", () => {
    sidebar.classList.toggle("-translate-x-full");
    sidebar.classList.toggle("translate-x-0");

    if (sidebar.classList.contains("-translate-x-full")) {
      toggleButton.classList.remove("right-4");
      sidebar.classList.add("-z-10");
      sidebar.classList.remove("z-30");
      toggleButtonIcon.src = "images/icons/sidebarIcon.svg";
    } else {
      toggleButtonIcon.src = "images/icons/closeIcon.png";
      toggleButton.classList.remove("shadow-lg");
      sidebar.classList.add("z-30");
      sidebar.classList.remove("-z-10");
    }
  });

  function openLogoutModal() {
    logoutModal.classList.remove("hidden");
    // Ensure the sidebar is closed when logout modal is opened
    toggleButton.classList.remove("right-4");
      sidebar.classList.add("-z-10");
      sidebar.classList.remove("z-30");
      toggleButtonIcon.src = "images/icons/sidebarIcon.svg";

  }

  function closeLogoutModal() {
    logoutModal.classList.add("hidden");
    toggleButtonIcon.src = "images/icons/closeIcon.png";
      toggleButton.classList.remove("shadow-lg");
      sidebar.classList.add("z-30");
      sidebar.classList.remove("-z-10");
  }

  logoutModal.addEventListener("click", function (event) {
    if (event.target === logoutModal) {
      closeLogoutModal();
    }
  });


  function deleteAllCookies() {
    console.log(document.cookie);

    document.cookie.split(";").forEach(function (c) {
      document.cookie = c
        .replace(/^ +/, "")
        .replace(/=.*/, "=;expires=" + new Date(0).toUTCString() + ";path=/");
    });
  }

  async function logout() {
    try {
      const response = await fetch("/auth/logout", {
        method: "POST",
        credentials: "include",
      });

      console.log("logout res", response);

      if (response.ok) {
        window.location.href = "/signin";
      } else {
        console.error("Logout failed");
      }
      closeLogoutModal();
    } catch (error) {
      console.error("Error during logout:", error);
      closeLogoutModal();
    }
  }
</script>

<div class="absolute h-full  pt-10 transition-transform transform -translate-x-full font-roboto" id="sidebar">
<aside
  
  class="<%= user.settings.theme === 'dark' ? 'bg-dark-background text-dark-text' : 'bg-primary text-background' %> backdrop-blur-sm bg-opacity-50 shadow-lg  sticky left-0 top-0   h-screen "
>
  <div class="backdrop-blur-lg p-8 py-2 h-full">
    <div class="profile-sidebar">
      <div class="profile-sidebar-header border-b <%= user.settings.theme === 'dark' ? ' border-dark-tertiary' : ' border-tertiary' %>">
        <div class="profile-sidebar-header-image mb-1 flex justify-center">
          <img
            src="<%= user.avatar ? user.avatar : '/images/defaultProfile.png' %>"
            alt="Profile Image"
            class="w-28 h-28 rounded-full border border-gray-300"
          />
        </div>
        <div class="profile-sidebar-header-content text-center">
          <p class="<%= user.settings.theme === 'dark' ? ' text-dark-tertiary' : ' text-fifth' %>  text-left text-xs my-1 font-lora">
            @<%= user.username %>
          </p>
          <div
            class="flex gap-2 items-center text-lg font-bold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-sixth' %> overflow-clip font-lora"
          >
            <h3><%= user.firstname %></h3>
            <h3><%= user.lastname %></h3>
          </div>
        </div>
      </div>
      <div class="grid grid-cols-3 gap-2 border-b  <%= user.settings.theme === 'dark' ? ' border-dark-tertiary' : '  border-tertiary' %>  py-2">
        <a href="/profile/<%= user.slug%>" class="text-center cursor-pointer hover:scale-110">
          <h2 class="text-xl font-semibold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background hover:text-fifth' %>">
            <%= user.blogs.length %>
          </h2>
          <p class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-fifth' %> text-xs">Blogs</p>
        </a>
        <a
          href="/followers"
          class="text-center cursor-pointer hover:scale-110"
        >
          <h2 class="text-xl font-semibold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background hover:text-fifth' %>">
            <%= user.followers.length %>
          </h2>
          <p class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-fifth' %> text-xs">Followers</p>
        </a>
        <a
          href="/following"
          class="text-center cursor-pointer hover:scale-110"
        >
          <h2 class="text-xl font-semibold <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background hover:text-fifth' %>">
            <%= user.following.length %>
          </h2>
          <p class="<%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-fifth' %> text-xs">Following</p>
        </a>
      </div>
      <div class="profile-sidebar-content py-6">
        <ul
          class="space-y-2 sm:space-y-1 md:space-y-2 text-base md:text-sm lg:text-base"
        >
          <li class="flex items-center gap-2">
            <img src="images/icons/profileIcon.png" alt="profile icon" class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a href="/profile/<%= user.slug%>" class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Profile</a
            >
          </li>
          <li class="flex items-center gap-2">
            <img
              src="images/icons/editProfileIcon.png"
              alt="edit profile icon"
              class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"
            />
            <a
              href="/profile/edit"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Edit Profile</a
            >
          </li>
          <li class="flex items-center gap-2">
            <img src="images/icons/savedBlogIcon.png" alt="draft icon" class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a
              href="/saveBlogs"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Saved Blogs</a
            >
          </li>
          
          <li class="flex items-center gap-2">
            <img src="images/icons/draftIcon.png" alt="draft icon" class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a
              href="/drafts"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Drafts</a
            >
          </li>
          <li class="flex items-center gap-2">
            <img src="images/icons/archiveIcon.png" alt="draft icon" class="w-5 h-5 <%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a
              href="/archived"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Archived</a
            >
          </li>
          <li class="flex items-center gap-2">
            <img src="images/icons/reportIcon.png" alt="report icon" class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a
              href="/reports"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Reports</a
            >
          </li>
          <li class="flex items-center gap-2">
            <img src="images/icons/analyticIcon.png" alt="analytic icon" class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a
              href="/analytics"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Analytics</a
            >
          </li>
          <li class="flex items-center gap-2">
            <img src="images/icons/notifyIcon.png" alt="notification icon"  class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <a
              href="/notifications"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
              >Notifications</a
            >
          </li>

          <li class="flex items-center gap-2">
            <img src="images/icons/logoutIcon.png" alt="log out icon" class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert' %>"/>
            <button
              onclick="openLogoutModal()"
              class="block <%= user.settings.theme === 'dark' ? ' text-dark-text' : ' text-background' %> hover:text-fifth"
            >
              Log Out
            </button>
          </li>
        </ul>
      </div>

      <div class="grid grid-cols-2 gap-2 mt-2">
        <a
          href="/settings"
          class="<%= user.settings.theme === 'dark' ? 'bg-dark-fifth hover:bg-dark-background' : 'bg-tertiary hover:bg-fourth hover:invert-0' %>  p-3 rounded-md flex justify-center items-center"
        >
          <img src="images/icons/settingIcon.png" alt="Settings" 
          class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert ' %>"/>
        </a>
        <a
          href="/contact"
          class="<%= user.settings.theme === 'dark' ? 'bg-dark-fifth hover:bg-dark-background' : 'bg-tertiary hover:bg-fourth' %>  p-3 rounded-md flex justify-center items-center"
        >
          <img src="images/icons/supportIcon.png" alt="Support" 
          class="<%= user.settings.theme === 'dark' ? 'invert' : 'invert ' %>"/>
        </a>
      </div>
    </div>
  </div>
</aside>
</div>

<div
  id="logoutModal"
  class="fixed inset-0 <%= user.settings.theme === 'dark' ? 'bg-dark-primary text-dark-text' : ' text-text bg-primary' %> backdrop-blur-sm bg-opacity-50 flex items-center justify-center hidden z-50 p-5 md:p-0"
>
  <div class="<%= user.settings.theme === 'dark' ? 'bg-dark-background text-dark-text' : 'bg-background text-text' %> p-4 rounded-lg w-full sm:w-1/2 lg:w-1/3">
    <h2 class="text-xl font-semibold">Confirm Logout</h2>
    <p class="mt-2">Are you sure you want to log out?</p>
    <div class="mt-4 flex justify-end gap-4">
      <button
        id="cancelLogoutButton"
        class="px-4 py-2 bg-gray-500 text-white rounded"
      >
        Cancel
      </button>
      <button
        id="confirmLogoutButton"
        class="px-4 py-2 bg-red-500 text-white rounded"
      >
        Log Out
      </button>
    </div>
  </div>
</div>

<script>
  const sidebar = document.getElementById("sidebar");
  const toggleButton = document.getElementById("sidebarToggle");
  const toggleButtonIcon = document.getElementById("sidebarToggleIcon");

  toggleButton.addEventListener("click", () => {
    sidebar.classList.toggle("-translate-x-full");
    sidebar.classList.toggle("translate-x-0");

    if (sidebar.classList.contains("-translate-x-full")) {
      toggleButton.classList.remove("right-4");
      sidebar.classList.add("-z-10");
      sidebar.classList.remove("z-30");
      toggleButtonIcon.src = "images/icons/sidebarIcon.svg";
    } else {
      toggleButtonIcon.src = "images/icons/closeIcon.png";
      toggleButton.classList.remove("shadow-lg");
      sidebar.classList.add("z-30");
      sidebar.classList.remove("-z-10");
    }
  });

  function openLogoutModal() {
    document.getElementById("logoutModal").classList.remove("hidden");
  }

  function closeLogoutModal() {
    document.getElementById("logoutModal").classList.add("hidden");
  }

  function deleteAllCookies() {
    console.log(document.cookie); 

    document.cookie.split(";").forEach(function (c) {
      document.cookie = c
        .replace(/^ +/, "")
        .replace(/=.*/, "=;expires=" + new Date(0).toUTCString() + ";path=/");
    });
  }

  async function logout() {
    try {
      const response = await fetch("/auth/logout", {
        method: "POST",
        credentials: "include",
      });

      console.log("logout res", response);

      if (response.ok) {
        window.location.href = "/signin";
      } else {
        console.error("Logout failed");
      }
    } catch (error) {
      console.error("Error during logout:", error);
    }
  }

  document
    .getElementById("cancelLogoutButton")
    .addEventListener("click", closeLogoutModal);
  document
    .getElementById("confirmLogoutButton")
    .addEventListener("click", function () {
      logout();
      closeLogoutModal();
    });
</script>
